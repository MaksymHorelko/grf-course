#include <iostream>
#include <NTL/ZZ.h>

using namespace std;
using namespace NTL;

ZZ ModExp(const ZZ &a, const ZZ &b, const ZZ &p)
{
    ZZ result;
    PowerMod(result, a, b, p);
    return result;
}

ZZ DiffieHellman(const ZZ &p, const ZZ &g, const ZZ &a, const ZZ &b)
{
    ZZ ga = ModExp(g, a, p);
    ZZ gb = ModExp(g, b, p);

    ZZ secret_a = ModExp(gb, a, p);
    ZZ secret_b = ModExp(ga, b, p);

    if (secret_a == secret_b)
    {
        return secret_a;
    }
    else
    {
        cout << "Помилка!" << endl;
        return ZZ(0);
    }
}

int main()
{
    // 10 біт
    ZZ p1, g1, a1, b1;
    p1 = conv<ZZ>("449");
    g1 = conv<ZZ>("19");
    a1 = conv<ZZ>("4");
    b1 = conv<ZZ>("5");
    ZZ secret1 = DiffieHellman(p1, g1, a1, b1);
    cout << "Спільний секрет (до 10 біт): " << secret1 << endl;

    // 100 біт
    ZZ p2, g2, a2, b2;
    p2 = conv<ZZ>("34662321099990647697175478273");
    g2 = conv<ZZ>("649");
    a2 = conv<ZZ>("840843318095746");
    b2 = conv<ZZ>("624535580970443");
    ZZ secret2 = DiffieHellman(p2, g2, a2, b2);
    cout << "Спільний секрет (до 100 біт): " << secret2 << endl;

    // 4096 біт
    ZZ p3, g3, a3, b3;
    p3 = conv<ZZ>("720260107635977384669674295427926438006560183586151949469675655505979595786286545176919293564411266131000186156645824261633559912200452869712953012060048146292363331676515225185785804771072704428306020549026668123419579192953326792753628457980932844086521051361585155707546789173899809333208722891868537176998259316637014599384613667878137522028123510073514788320638172758428824196059827531780115570580411550292289102442051435318160920672541221724179862807676079229593355896126823522415972230999836315453037851723494722397747030336887636453798208636047208001626917054580058621137920670394737770237793963045549458017926276785533429776906875872463664411842838601851059531563369587468397408144667845190362798916304697767949007445722069881139710961827711606074089761924556175638870661018801536941740059937402509673707178005048220303541060510769681939606730117311038077245482214580970114460166422590416835818830203805281755517708994370264873175048647036866637582189620446857914209007971297863507185057388439014104839321143791256105136506844065441654918860018221766113674472773414003503672090355990161207465298965416698871157263672455792565483142370177216037504184242654496694425827366896571015558253701025516625738803451008838413584981731634242102142325804820604245484543858105331129071165041597884658496362439526337840266893768958054119251388737986016843905977309794654124619243142786741555456989501848498348847220507680287553396354704989060567714193595901823994879507752500002442761959249558268764217804465483302538601488579654327248706993308451310332077572785537139119395391523543617246805704051327122281537878986293164532840148211297778446309424400590992184371384076581843035677646460377557286786330495619028487987641209654381021871999704904652207524340680885848131066734383399956450803333298262009562680654137764856087984815497320667130030416904827637177760183143546508387852447829957830388310077648358229705048818254071506457770800757541891772912932841863921714699673928718847868700551282689");
    g3 = conv<ZZ>("829");
    a3 = power2_ZZ(1000);
    b3 = power2_ZZ(3000);
    ZZ secret3 = DiffieHellman(p3, g3, a3, b3);
    cout << "Спільний секрет (до 4096 біт): " << secret3 << endl;

    return 0;
}
